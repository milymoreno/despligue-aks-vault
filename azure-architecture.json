{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "managedClusters_aks_holamundo_dev_name": {
      "type": "String"
    },
    "registries_holamundoacr_name": {
      "type": "String"
    },
    "userAssignedIdentities_aks_holamundo_dev_agentpool_externalid": {
      "type": "String"
    },
    "vaults_kv_holamundo_dev_name": {
      "type": "String"
    }
  },
  "resources": [
    {
      "apiVersion": "2025-05-01-preview",
      "location": "eastus",
      "name": "[parameters('registries_holamundoacr_name')]",
      "properties": {
        "adminUserEnabled": true,
        "anonymousPullEnabled": false,
        "autoGeneratedDomainNameLabelScope": "Unsecure",
        "dataEndpointEnabled": false,
        "encryption": {
          "status": "disabled"
        },
        "metadataSearch": "Disabled",
        "networkRuleBypassAllowedForTasks": false,
        "networkRuleBypassOptions": "AzureServices",
        "policies": {
          "azureADAuthenticationAsArmPolicy": {
            "status": "enabled"
          },
          "exportPolicy": {
            "status": "enabled"
          },
          "quarantinePolicy": {
            "status": "disabled"
          },
          "retentionPolicy": {
            "days": 7,
            "status": "disabled"
          },
          "softDeletePolicy": {
            "retentionDays": 7,
            "status": "disabled"
          },
          "trustPolicy": {
            "status": "disabled",
            "type": "Notary"
          }
        },
        "publicNetworkAccess": "Enabled",
        "roleAssignmentMode": "LegacyRegistryPermissions",
        "zoneRedundancy": "Disabled"
      },
      "sku": {
        "name": "Basic",
        "tier": "Basic"
      },
      "tags": {
        "Env": "dev",
        "Project": "Test"
      },
      "type": "Microsoft.ContainerRegistry/registries"
    },
    {
      "apiVersion": "2025-05-01",
      "identity": {
        "type": "SystemAssigned"
      },
      "location": "centralus",
      "name": "[parameters('managedClusters_aks_holamundo_dev_name')]",
      "properties": {
        "agentPoolProfiles": [
          {
            "count": 1,
            "enableAutoScaling": false,
            "enableEncryptionAtHost": false,
            "enableFIPS": false,
            "enableNodePublicIP": false,
            "enableUltraSSD": false,
            "kubeletDiskType": "OS",
            "maxPods": 250,
            "mode": "System",
            "name": "nodepool1",
            "orchestratorVersion": "1.32",
            "osDiskSizeGB": 128,
            "osDiskType": "Managed",
            "osSKU": "Ubuntu",
            "osType": "Linux",
            "powerState": {
              "code": "Running"
            },
            "scaleDownMode": "Delete",
            "securityProfile": {
              "enableSecureBoot": false,
              "enableVTPM": false
            },
            "type": "VirtualMachineScaleSets",
            "upgradeSettings": {
              "maxSurge": "10%",
              "maxUnavailable": "0"
            },
            "vmSize": "Standard_A2_v2"
          }
        ],
        "autoUpgradeProfile": {
          "nodeOSUpgradeChannel": "NodeImage"
        },
        "bootstrapProfile": {
          "artifactSource": "Direct"
        },
        "disableLocalAccounts": false,
        "dnsPrefix": "aks-holamu-rg-aks-holamundo-0932a5",
        "enableRBAC": true,
        "identityProfile": {
          "kubeletidentity": {
            "clientId": "4883f027-1471-41e1-95ae-0032e5127e29",
            "objectId": "58519a15-e15c-4770-a1e0-890778f1fed7",
            "resourceId": "[parameters('userAssignedIdentities_aks_holamundo_dev_agentpool_externalid')]"
          }
        },
        "kubernetesVersion": "1.32",
        "linuxProfile": {
          "adminUsername": "azureuser",
          "ssh": {
            "publicKeys": [
              {
                "keyData": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDvuS2Pj/C0Hj0awZNHiVjfQVPIxVkmVS4+D3fgWYwddmYibmWjAYFuVtZyMsH8u9TS8mCi33VEUKGu3WhwOmWpi1MOSE6gyiKE/9XJL+yAM7y/MUaGLk774zojZs16i3/IHKPHFqsOpm6kWoZ4zNL703c+q5m1cLQd1EnxcGg0bRRb5yzd9iUscRqprTvUM/FNcq4H5ZNjuk7+NyIjYu0ROWo1CJKS8c3l94pzEB/Jw5bDrOAyEGBOTbiJm394hX8t9ZcoV+pp+D+3R+q7NRVj855fG3f61bxkN4Oe3l82ilpFizgZVQSqEinhbjoWccaCFUgCY0+k0J+hSW8E2wG/"
              }
            ]
          }
        },
        "metricsProfile": {
          "costAnalysis": {
            "enabled": false
          }
        },
        "networkProfile": {
          "dnsServiceIP": "10.0.0.10",
          "ipFamilies": [
            "IPv4"
          ],
          "loadBalancerProfile": {
            "backendPoolType": "nodeIPConfiguration",
            "managedOutboundIPs": {
              "count": 1
            }
          },
          "loadBalancerSku": "standard",
          "networkDataplane": "azure",
          "networkPlugin": "azure",
          "networkPluginMode": "overlay",
          "networkPolicy": "none",
          "outboundType": "loadBalancer",
          "podCidr": "10.244.0.0/16",
          "podCidrs": [
            "10.244.0.0/16"
          ],
          "serviceCidr": "10.0.0.0/16",
          "serviceCidrs": [
            "10.0.0.0/16"
          ]
        },
        "nodeProvisioningProfile": {
          "defaultNodePools": "Auto",
          "mode": "Manual"
        },
        "nodeResourceGroup": "[concat('MC_rg-', parameters('managedClusters_aks_holamundo_dev_name'), '_', parameters('managedClusters_aks_holamundo_dev_name'), '_centralus')]",
        "oidcIssuerProfile": {
          "enabled": false
        },
        "securityProfile": {},
        "servicePrincipalProfile": {
          "clientId": "msi"
        },
        "storageProfile": {
          "diskCSIDriver": {
            "enabled": true
          },
          "fileCSIDriver": {
            "enabled": true
          },
          "snapshotController": {
            "enabled": true
          }
        },
        "supportPlan": "KubernetesOfficial",
        "workloadAutoScalerProfile": {}
      },
      "sku": {
        "name": "Base",
        "tier": "Free"
      },
      "type": "Microsoft.ContainerService/managedClusters"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "location": "centralus",
      "name": "[parameters('vaults_kv_holamundo_dev_name')]",
      "properties": {
        "accessPolicies": [],
        "enableRbacAuthorization": true,
        "enableSoftDelete": true,
        "enabledForDeployment": false,
        "enabledForDiskEncryption": false,
        "enabledForTemplateDeployment": false,
        "provisioningState": "Succeeded",
        "publicNetworkAccess": "Enabled",
        "sku": {
          "family": "A",
          "name": "standard"
        },
        "softDeleteRetentionInDays": 90,
        "tenantId": "11d15a33-bc3d-4a4e-ac46-93df6b48769a",
        "vaultUri": "[concat('https://', parameters('vaults_kv_holamundo_dev_name'), '.vault.azure.net/')]"
      },
      "type": "Microsoft.KeyVault/vaults"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_holamundoacr_name'))]"
      ],
      "name": "[concat(parameters('registries_holamundoacr_name'), '/_repositories_admin')]",
      "properties": {
        "actions": [
          "repositories/*/metadata/read",
          "repositories/*/metadata/write",
          "repositories/*/content/read",
          "repositories/*/content/write",
          "repositories/*/content/delete"
        ],
        "description": "Can perform all read, write and delete operations on the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_holamundoacr_name'))]"
      ],
      "name": "[concat(parameters('registries_holamundoacr_name'), '/_repositories_pull')]",
      "properties": {
        "actions": [
          "repositories/*/content/read"
        ],
        "description": "Can pull any repository of the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_holamundoacr_name'))]"
      ],
      "name": "[concat(parameters('registries_holamundoacr_name'), '/_repositories_pull_metadata_read')]",
      "properties": {
        "actions": [
          "repositories/*/content/read",
          "repositories/*/metadata/read"
        ],
        "description": "Can perform all read operations on the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_holamundoacr_name'))]"
      ],
      "name": "[concat(parameters('registries_holamundoacr_name'), '/_repositories_push')]",
      "properties": {
        "actions": [
          "repositories/*/content/read",
          "repositories/*/content/write"
        ],
        "description": "Can push to any repository of the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerRegistry/registries', parameters('registries_holamundoacr_name'))]"
      ],
      "name": "[concat(parameters('registries_holamundoacr_name'), '/_repositories_push_metadata_write')]",
      "properties": {
        "actions": [
          "repositories/*/metadata/read",
          "repositories/*/metadata/write",
          "repositories/*/content/read",
          "repositories/*/content/write"
        ],
        "description": "Can perform all read and write operations on the registry"
      },
      "type": "Microsoft.ContainerRegistry/registries/scopeMaps"
    },
    {
      "apiVersion": "2025-05-01",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerService/managedClusters', parameters('managedClusters_aks_holamundo_dev_name'))]"
      ],
      "name": "[concat(parameters('managedClusters_aks_holamundo_dev_name'), '/nodepool1')]",
      "properties": {
        "count": 1,
        "enableAutoScaling": false,
        "enableEncryptionAtHost": false,
        "enableFIPS": false,
        "enableNodePublicIP": false,
        "enableUltraSSD": false,
        "kubeletDiskType": "OS",
        "maxPods": 250,
        "mode": "System",
        "orchestratorVersion": "1.32",
        "osDiskSizeGB": 128,
        "osDiskType": "Managed",
        "osSKU": "Ubuntu",
        "osType": "Linux",
        "powerState": {
          "code": "Running"
        },
        "scaleDownMode": "Delete",
        "securityProfile": {
          "enableSecureBoot": false,
          "enableVTPM": false
        },
        "type": "VirtualMachineScaleSets",
        "upgradeSettings": {
          "maxSurge": "10%",
          "maxUnavailable": "0"
        },
        "vmSize": "Standard_A2_v2"
      },
      "type": "Microsoft.ContainerService/managedClusters/agentPools"
    },
    {
      "apiVersion": "2024-12-01-preview",
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_kv_holamundo_dev_name'))]"
      ],
      "location": "centralus",
      "name": "[concat(parameters('vaults_kv_holamundo_dev_name'), '/APP-MESSAGE')]",
      "properties": {
        "attributes": {
          "enabled": true
        }
      },
      "tags": {
        "file-encoding": "utf-8"
      },
      "type": "Microsoft.KeyVault/vaults/secrets"
    },
    {
      "apiVersion": "2025-04-02-preview",
      "dependsOn": [
        "[resourceId('Microsoft.ContainerService/managedClusters/agentPools', parameters('managedClusters_aks_holamundo_dev_name'), 'nodepool1')]",
        "[resourceId('Microsoft.ContainerService/managedClusters', parameters('managedClusters_aks_holamundo_dev_name'))]"
      ],
      "name": "[concat(parameters('managedClusters_aks_holamundo_dev_name'), '/nodepool1/aks-nodepool1-41205086-vmss000000')]",
      "properties": {
        "network": {}
      },
      "type": "Microsoft.ContainerService/managedClusters/agentPools/machines"
    }
  ],
  "variables": {}
}
